#!/bin/bash

set -e
set -o pipefail

export OPENMBVCPPINTERFACE_PREFIX="@native_prefix@"
# "script" is needed to avoid "Py_Initialize: can't initialize sys standard streams" when running with wine
script -qec "@XC_EXEC_PREFIX@ @prefix@/bin/h5lockserie@EXEEXT@ --remove MBS_outfile.ombvh5 || echo 'failed but continuing'" /dev/null
script -qec "@XC_EXEC_PREFIX@ @PYTHON_BIN@ @abs_srcdir@/pythontest.py | tee result.txt" /dev/null

diff --strip-trailing-cr @abs_srcdir@/result-ref.txt result.txt

diff --strip-trailing-cr @abs_srcdir@/../MBS_outfile-ref.ombvx MBS_outfile.ombvx
